<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Mafioso</title>

        <script type="text/javascript">
            $(function() {

                var conn;
                var msg = $("#msg");
                var log = $("#log");

                function appendLog(msg) {
                    var d = log[0]
                    var doScroll = d.scrollTop == d.scrollHeight - d.clientHeight;
                    msg.appendTo(log)
                    if (doScroll) {
                        d.scrollTop = d.scrollHeight - d.clientHeight;
                    }
                }

                $("#form").submit(function() {
                    if (!conn) {
                        return false;
                    }
                    if (!msg.val()) {
                        return false;
                    }
                    conn.send(JSON.stringify({msgType:"chat",data:{message:msg.val()}}));
                    msg.val("");
                    return false
                });

                if (window["WebSocket"]) {
                    conn = new WebSocket("ws://"+window.location.host+window.location.pathname+"ws/");
                    conn.onclose = function(evt) {
                        appendLog($("<div><b>Connection closed.</b></div>"))
                    }
                    conn.onmessage = function(evt) {
                        appendLog($("<div/>").text(evt.data))
                    }
                } else {
                    appendLog($("<div><b>Your browser does not support WebSockets.</b></div>"))
                }
            });
        </script>
        <link rel="stylesheet" href="styles/main.css">
    </head>
    <body ng-app="mafiachat">
        <div id="log"></div>
        <form id="form">
            <input type="submit" value="Send" />
            <input type="text" id="msg" size="64"/>
        </form>

        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.8/angular.min.js"></script>
    </body>
</html>